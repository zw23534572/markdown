##JVM内存模型

Java中通过多线程机制使得多个任务同时执行处理，所有的线程共享JVM内存区域main memory，而每个线程又单独的有自己的工作内存，当线程与内存区域进行交互时，数据从主存拷贝到工作内存，进而交由线程处理（操作码+操作数）。

- `程序计数器`-程序计数器是一块很小的内存空间，用于记录下一条要运行的指令。每个线程都需要一个程序计数器，各个线程之中的计数器相互独立，是线程中私有的内存空间
- `本地方法栈`-本地方法栈和java虚拟机栈的功能相似，java虚拟机栈用于管理Java函数的调用，而本地方法栈用于管理本地方法的调用，但不是由Java实现的，而是由C实现的
- `Java 堆`-为所有创建的对象和数组分配内存空间,被JVM中所有的线程共享
- `Java 栈`-java虚拟机栈也是线程私有的内存空间，它和java线程同一时间创建，保存了局部变量、部分结果，并参与方法的调用和返回
- `方法区` - 也被称为永久区，与堆空间相似，被JVM中所有的线程共享。方法区主要保存的信息是类的元数据，方法区中最为重要的是类的类型信息、常量池、域信息、方法信息，其中运行时常量池就在方法区，对永久区的GC回收，一是GC对永久区常量池的回收;二是永久区对元数据的回收

![](http://oi9kolnxs.bkt.clouddn.com/300854081661499.jpg)

## Java堆-存储结构

![](http://images.cnitblog.com/blog2015/471532/201504/082030101189523.png)

- `新生代`-(Eden,S1,S2）
- `老年代`-(Old Generation)
- `永久带`-运行时常量和内部字符串，**永久代**是**Hotspot**虚拟机特有的概念

注意：在JDK1.8中，持久代已经更名为了元空间。



## 常用的JVM参数设定

常用的参数设定

- `-Xms`1024M ，最小堆内存(默认为物理内存的1/64但小于1G),设置：`-Xms1024M`
- `-Xmx`1024M，最大堆内存(默认是物理内存的1/4但小于1G),设置：`-Xmx1024M`
- `-XX:PermSize`=64M  设置最小分配永久代空间,设置：``-XX:PermSize=64M``
- `-XX:MaxPermSize`=128M 设置最大分配永久代空间,设置：`-XX:MaxPermSize=128M`
- JDK1.8修改为``-XX:MetaspaceSize=200m``;``-XX:MaxMetaspaceSize=256m;``


